---
title: The title of your Semesterproject
subtitle: A subtle subtitle
author: Firstname1 Lastname1 and Firstname2 Lastname2
format:
  html:
    code-fold: true
execute:
  warning: false
  message: false
lang: en  # switch to "de" if you write your report in german
bibliography: bibliography.bib
---

```{r preprocessing}
#| code-summary: preprocessing

# Als erstes: Die Dateien sind im FIT Format: wir brauchen das Package FITfileR
if(!requireNamespace("remotes")) {
    install.packages("remotes")
}

remotes::install_github("grimbough/FITfileR")

library(FITfileR)
library(sf)
library(ggplot2)
library(dplyr)

fit2sf <- function(fit_path){
  # fit_path <- "10062007438.fit"

# Daten einlesen:
  fit_data <- readFitFile(fit_path)
records <- records(fit_data)

  df <- records[[1]]

  st_as_sf(records[[1]], coords = c("position_long", "position_lat"), crs = 4326) |> 
    mutate(fit_file = fit_path)
}

fitfiles <- list.files(pattern = "\\.fit$")

fit_list <- lapply(fitfiles, fit2sf)

do.call(rbind, fit_list) |> View()



convert_to_degrees <- function(semi_circles) {
  semi_circles * (180 / 2^31)
}

# Datenrahmen erstellen für alle Aufzeichnungen
coords_list <- lapply(records, function(record) {
  if ("position_lat" %in% names(record) & "position_long" %in% names(record)) {
    lat <- convert_to_degrees(record$position_lat)
    long <- convert_to_degrees(record$position_long)
    data.frame(latitude = lat, longitude = long)
  } else {
    NULL
  }
})

coords_list <- coords_list[!sapply(coords_list, is.null)]


# Konvertieren der Koordinaten in räumliche Objekte und transformieren
coords_lv95_list <- lapply(coords_list, function(coords) {
  coords_sf <- st_as_sf(coords, coords = c("longitude", "latitude"), crs = 4326) # WGS84
  st_transform(coords_sf, crs = 2056) # LV95
})

# Alle Läufe in einen DataFrame zusammenführen
coords_lv95_all <- do.call(rbind, lapply(seq_along(coords_lv95_list), function(i) {
  coords_lv95_list[[i]]$run <- paste("Run", i)
  coords_lv95_list[[i]]
}))

# Plotten der Läufe auf einer Karte
ggplot() +
  geom_sf(data = coords_lv95_all, aes(), size = 1) +
  theme_minimal() +
  labs(title = "erster Lauf",
       x = "E",
       y = "N",
       color = "Lauf")

library("tmap")

tmap_mode("view")

tm_shape(records) + 
  tm_dots()

``` 


## Abstract

## Introduction

@laube2011 investigate how temporal scale affects the calculation of movement parameters (speed, sinuosity and turning angle) of animal trajectories. 

## Material and Methods

## Results

## Discussion

## Appendix

### Wordcount

<!-- after installing the wordcountadding, remove the line "#| eval: false" -->

```{r}
#| eval: false
wordcountaddin::word_count("index.qmd")
```


